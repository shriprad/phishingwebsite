<div class="search-box">
    <button id="fetch-btn">Fetch</button>
</div>

<div id="fetch-loading" class="loading">
    Fetching phishing URLs from OpenPhish...
</div>

<div id="fetch-result" class="analysis-result"></div>

<script>
    document.getElementById('fetch-btn').addEventListener('click', async () => {
        const loading = document.getElementById('fetch-loading');
        const result = document.getElementById('fetch-result');

        loading.classList.add('active');
        result.innerHTML = ''; // Clear previous results

        try {
            const response = await fetch('/fetch');
            const data = await response.json();

            if (data.error) {
                result.innerHTML = `<div class="error-message">${data.error}</div>`;
            } else {
                result.innerHTML = `
                    <div class="url-components">
                        <h2>Phishing URL Statistics</h2>
                        <p>Total URLs Fetched: ${data.total_urls}</p>
                        <p>AWS-Hosted Phishing URLs: ${data.aws_count}</p>
                        ${data.aws_urls.length > 0
                            ? `<ul>${data.aws_urls.map(url => `<li>${url}</li>`).join('')}</ul>`
                            : '<p>No AWS-hosted phishing URLs found.</p>'
                        }
                    </div>`;
            }
        } catch (err) {
            result.innerHTML = `<div class="error-message">Error fetching data: ${err.message}</div>`;
        } finally {
            loading.classList.remove('active');
        }
    });
</script>
